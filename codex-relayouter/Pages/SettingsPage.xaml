<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="codex_bridge.Pages.SettingsPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">

    <ScrollViewer Padding="24" VerticalScrollBarVisibility="Auto">
        <StackPanel MaxWidth="800" Spacing="24" HorizontalAlignment="Left">
            
            <!-- 页面标题 -->
            <TextBlock Text="设置" Style="{StaticResource TitleTextBlockStyle}" />

            <!-- 连接状态卡片 -->
            <Border
                Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                BorderThickness="1"
                CornerRadius="8"
                Padding="16">
                <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="12">
                    <Ellipse
                        x:Name="StatusIndicator"
                        Width="12"
                        Height="12"
                        Fill="{ThemeResource SystemFillColorCautionBrush}"
                        VerticalAlignment="Center" />
                    <TextBlock
                        x:Name="ConnectionStatusText"
                        Grid.Column="1"
                        Text="未连接"
                        VerticalAlignment="Center"
                        Style="{StaticResource BodyStrongTextBlockStyle}" />
                    <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="8">
                        <Button x:Name="ConnectButton" Click="ConnectButton_Click" Content="连接" />
                        <Button x:Name="DisconnectButton" Click="DisconnectButton_Click" Content="断开" IsEnabled="False" />
                    </StackPanel>
                </Grid>
            </Border>

            <!-- 连接配置 -->
            <StackPanel Spacing="4">
                <TextBlock Text="连接配置" Style="{StaticResource SubtitleTextBlockStyle}" />
                <TextBlock Text="配置 Bridge Server 连接参数" Opacity="0.7" />
            </StackPanel>

            <!-- 服务器地址 -->
            <TextBox
                x:Name="ServerUrlTextBox"
                Header="WebSocket 地址"
                PlaceholderText="留空将自动启动本地服务"
                TextChanged="ConfigChanged" />

            <!-- Token -->
            <PasswordBox
                x:Name="BearerTokenBox"
                Header="Bearer Token（可选）"
                PlaceholderText="用于身份验证"
                PasswordChanged="ConfigChanged" />

            <!-- 工作区目录 -->
            <Grid ColumnDefinitions="*,Auto" ColumnSpacing="8">
                <TextBox
                    x:Name="WorkingDirectoryTextBox"
                    Header="工作区目录"
                    PlaceholderText="例如 C:\Users\project"
                    TextChanged="ConfigChanged" />
                <Button
                    x:Name="BrowseButton"
                    Grid.Column="1"
                    Content="浏览…"
                    Click="BrowseButton_Click"
                    VerticalAlignment="Bottom" />
            </Grid>

            <!-- 模型与沙箱 -->
            <StackPanel Spacing="4" Margin="0,16,0,0">
                <TextBlock Text="高级选项" Style="{StaticResource SubtitleTextBlockStyle}" />
            </StackPanel>

            <Grid ColumnDefinitions="*,*" ColumnSpacing="16" RowDefinitions="Auto,Auto" RowSpacing="16">
                <!-- 模型 -->
                <TextBox
                    x:Name="ModelTextBox"
                    Header="模型（可选）"
                    PlaceholderText="例如 o3"
                    TextChanged="ConfigChanged" />

                <!-- Sandbox -->
                <ComboBox
                    x:Name="SandboxComboBox"
                    Grid.Column="1"
                    Header="沙箱模式"
                    HorizontalAlignment="Stretch"
                    SelectedIndex="0"
                    SelectionChanged="ConfigChanged">
                    <ComboBoxItem Content="默认" Tag="" />
                    <ComboBoxItem Content="read-only" Tag="read-only" />
                    <ComboBoxItem Content="workspace-write" Tag="workspace-write" />
                    <ComboBoxItem Content="danger-full-access" Tag="danger-full-access" />
                </ComboBox>

                <!-- Approval Policy -->
                <ComboBox
                    x:Name="ApprovalPolicyComboBox"
                    Grid.Row="1"
                    Header="批准策略"
                    HorizontalAlignment="Stretch"
                    SelectedIndex="0"
                    SelectionChanged="ConfigChanged">
                    <ComboBoxItem Content="默认" Tag="" />
                    <ComboBoxItem Content="untrusted" Tag="untrusted" />
                    <ComboBoxItem Content="on-request" Tag="on-request" />
                    <ComboBoxItem Content="on-failure" Tag="on-failure" />
                    <ComboBoxItem Content="never" Tag="never" />
                </ComboBox>

                <!-- Effort -->
                <ComboBox
                    x:Name="EffortComboBox"
                    Grid.Row="1"
                    Grid.Column="1"
                    Header="Effort 级别"
                    HorizontalAlignment="Stretch"
                    SelectedIndex="0"
                    SelectionChanged="ConfigChanged">
                    <ComboBoxItem Content="默认" Tag="" />
                    <ComboBoxItem Content="low" Tag="low" />
                    <ComboBoxItem Content="medium" Tag="medium" />
                    <ComboBoxItem Content="high" Tag="high" />
                    <ComboBoxItem Content="xhigh" Tag="xhigh" />
                </ComboBox>
            </Grid>

            <!-- Git 检查 -->
            <CheckBox
                x:Name="SkipGitRepoCheckCheckBox"
                Content="跳过 Git 仓库检查"
                IsChecked="True"
                Margin="0,8,0,0" />

            <!-- 日志 -->
            <StackPanel Spacing="4" Margin="0,16,0,0">
                <TextBlock Text="日志" Style="{StaticResource SubtitleTextBlockStyle}" />
                <TextBlock Text="查看本机 Bridge Server 的运行日志" Opacity="0.7" />
            </StackPanel>

            <Button
                x:Name="ViewBackendLogsButton"
                Content="查看后端日志"
                Click="ViewBackendLogsButton_Click" />

            <!-- 状态消息 -->
            <TextBlock
                x:Name="StatusTextBlock"
                Opacity="0.7"
                TextWrapping="Wrap"
                Margin="0,16,0,0" />

        </StackPanel>
    </ScrollViewer>
</Page>
